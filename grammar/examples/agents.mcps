// agents.mcps - Agent workflow example
import { claude, gpt4 } from "./models.mcps"
import { github, filesystem } from "./connections.mcps"

agent CodeReviewer {
    model: claude
    
    systemPrompt: """
        You are a senior software engineer who reviews code for security,
        performance, and best practices. Provide detailed feedback.
    """
    
    tools: [
        github.searchCode,
        github.getRepository,
        filesystem.readFile
    ]
    
    temperature: 0.3
}

agent DocumentationWriter {
    model: gpt4
    
    systemPrompt: "You write clear, comprehensive technical documentation."
    
    tools: [filesystem.writeFile]
    
    temperature: 0.7
    maxTokens: 4000
}

workflow reviewAndDocument(repoPath: string): Result<void, Error> {
    // Read the main source file
    sourceCode = filesystem.readFile("${repoPath}/main.go")?
    
    // Agent review
    conv = "Review this Go code for security issues: ${sourceCode}" -> CodeReviewer
    conv += "What specific improvements would you recommend?"
    reviewResult = conv -> CodeReviewer
    
    // Generate documentation based on review
    docPrompt = "Create documentation for this code based on the review: ${reviewResult.getLastMessage()}"
    docResult = docPrompt -> DocumentationWriter
    
    // Save documentation
    filesystem.writeFile("${repoPath}/REVIEW.md", docResult.getLastMessage())?
    
    log.info("Review and documentation complete")
    return Ok(void)
}

// Execute if run directly
if RUN_STANDALONE {
    result = reviewAndDocument("/workspace/project")
    match result {
        Ok(_) => print("Review completed successfully!"),
        Err(e) => {
            log.error("Review failed: ${e}")
            return Err(e)
        }
    }
}